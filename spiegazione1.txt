Ecco una descrizione passo-passo di ciascun â€œmodaleâ€ (modal) presente nellâ€™applicazione, spiegando esattamente cosa fa, come viene aperto/chiuso e quali azioni compie lâ€™utente al suo interno.

1. ShiftModal (M1)
Quando si apre
Clic su una cella di calendario

Nella vista mese (MonthView), ogni giorno attivo Ã¨ un <div> cliccabile che chiama openShiftModal(date), passando la data selezionata.

openM1(date) (in CalendarApp) riceve quella data, salva selectedDate = date e legge da assignments eventuali assegnazioni giÃ  esistenti in tempAssignments.

Quindi imposta isM1Open = true, rendendo visibile il componente <ShiftModal â€¦ />.

Come appare
Sfondo semitrasparente e sfocato sullâ€™intera finestra (className="fixed inset-0 â€¦ bg-black/30 backdrop-blur-sm").

Contenitore centrale bianco arrotondato con ombra (max-w-sm p-5 rounded-xl shadow-xl).

Titolo in alto che mostra la data (es. â€œ05 Mar 2025â€), formattata con date-fns.

Cosa mostra
Elenco dei reparti/ruoli (hard-coded nellâ€™array roles = ["Sala 1", "Sala 2", â€¦]):

Per ogni ruolo, stampa una riga (<div className="flex justify-between items-center â€¦">) in cui:

A sinistra compare il testo:

Se tempAssignments[role] esiste, appare "Reparto â†’ Operatore", altrimenti solo il nome del reparto.

A destra compare lâ€™icona a forma di matita:

jsx
Copia
Modifica
<button onClick={() => openOperatorModal(role)} â€¦>
  {/* SVG Pencil */}
</button>
Cliccandola, si aprirÃ  il secondo modale (OperatorModal) per assegnare un operatore a quel ruolo.

Bottone â€œSalvaâ€ in fondo:

jsx
Copia
Modifica
<button onClick={save} â€¦>Salva</button>
Premendolo, si confermano (persistono) le assegnazioni e si chiude il modale.

Bottone â€œXâ€ di chiusura in alto a destra:

jsx
Copia
Modifica
<button onClick={close}>âœ•</button>
Premendolo, chiude il modale senza salvare (ripristina isM1Open = false in CalendarApp).

Flusso interno
Visualizzazione ruoli e assegnazioni provvisorie

tempAssignments Ã¨ stato inizializzato in openM1 copiando eventuali assegnazioni esistenti per selectedDate.

Quindi in ShiftModal, ogni riga mostra se tempAssignments[role] Ã¨ definito (es. â€œSala 1 â†’ Maccioniâ€) oppure solo â€œSala 1â€ se non ancora assegnato.

Clic sullâ€™icona matita di un ruolo

Chiama openOperatorModal(role), passando il ruolo selezionato.

In CalendarApp, openM2(role) setta selectedRole = role e isM2Open = true, aprendo <OperatorModal â€¦ />.

OperatorModal (vedi sezione successiva)

Lâ€™utente sceglie un operatore per quel ruolo; premendo un nome, selectOperator(op) aggiorna:

js
Copia
Modifica
setTempAssignments(prev => ({ ...prev, [selectedRole]: op }));
e chiude lâ€™OperatorModal (isM2Open = false).

Tornando in ShiftModal, la riga di quel ruolo ora mostra â€œReparto â†’ OperatoreSceltoâ€.

Salvataggio definitivo

Quando lâ€™utente preme â€œSalvaâ€:

In CalendarApp.saveM1() si genera la chiave key = format(selectedDate, "yyyy-MM-dd").

Viene fatto:

js
Copia
Modifica
setAssignments(prev => ({ ...prev, [key]: { ...tempAssignments } }));
in modo da salvare lâ€™oggetto tempAssignments (map da ruoloâ†’operatore) in assignments per quella data.

Si chiude il modale (isM1Open = false).

Una volta chiuso, nella griglia (MonthView) il giorno selezionato mostrerÃ , sotto la data, delle â€œpilloleâ€ colorate per ogni ruolo assegnato (gradevoli da vedere).

Annullamento

Se invece lâ€™utente premi â€œXâ€ senza salvare, closeM1() (che fa setIsM1Open(false)) chiude il modale e scarta le modifiche in tempAssignments.

2. OperatorModal (M2)
Quando si apre
Viene aperto da dentro ShiftModal con:

jsx
Copia
Modifica
<button onClick={() => openOperatorModal(role)}>â€¦</button>
openOperatorModal(role) in CalendarApp imposta:

js
Copia
Modifica
setSelectedRole(role);
setIsM2Open(true);
cosÃ¬ viene renderizzato <OperatorModal â€¦ />.

Come appare
Sfondo semi-trasparente simile (fixed inset-0 bg-black/30 backdrop-blur-sm).

Finestra centrale bianca arrotondata (max-w-xs p-6 rounded-xl shadow-xl).

Titolo: â€œSeleziona Operatore per {selectedRole}â€.

Cosa mostra
Griglia di pulsanti (3 colonne) con tutti gli operatori definiti in operators = ["Pestarino", "Maccioni", â€¦], ricevuti come prop.

Ogni pulsante ha stato:

Disabilitato (disabled) se lâ€™operatore Ã¨ giÃ  usato in tempAssignments (perchÃ© non si possono assegnare due ruoli allo stesso operatore nella stessa data).
La funzione isUsed(op) verifica:

js
Copia
Modifica
Object.values(tempAssignments).includes(op)
Selezionato (sfondo piÃ¹ scuro) se tempAssignments[selectedRole] === op.

Normale (verde chiaro) se disponibile e non ancora selezionato.

Flusso interno
Lista operatori

operators.map((op, idx) => { â€¦ }) crea i pulsanti.

Per ognuno:

Se isUsed(op) === true, il pulsante Ã¨ grigio e non cliccabile.

Altrimenti, Ã¨ verde e cliccabile.

Se tempAssignments[selectedRole] === op, significa che lâ€™utente lo aveva giÃ  eventualmente selezionato: il pulsante appare evidenziato (blu).

Selezione di un operatore

Se lâ€™utente clicca un pulsante non disabilitato:

jsx
Copia
Modifica
onClick={() => !used && selectOperator(op)}
chiama selectOperator(op).

selectOperator(op) in CalendarApp fa:

js
Copia
Modifica
setTempAssignments(prev => ({ ...prev, [selectedRole]: op }));
setIsM2Open(false);
â€“ Aggiorna tempAssignments con la coppia { [selectedRole]: op }.
â€“ Chiude OperatorModal (isM2Open = false).

Chiusura senza selezionare

In alto a destra câ€™Ã¨ una â€œXâ€. Se lâ€™utente la preme, close() richiama closeM2(), che fa setIsM2Open(false).

In tal caso, tempAssignments non cambia per quel ruolo, rimane allo stato precedente.

Ritorno a ShiftModal

Dopo la chiusura (sia con selezione sia con â€œXâ€), lâ€™utente torna a vedere ShiftModal con le assegnazioni aggiornate o invariata.

Da lÃ¬, potrÃ  continuare a selezionare altri ruoli o salvare/annullare.

3. StatsModal (M3)
Quando si apre
Cliccando il pulsante â€œStatisticheâ€ nella toolbar inferiore di CalendarApp:

jsx
Copia
Modifica
<button onClick={openStats}>ğŸ“Š Statistiche</button>
Il metodo openStats() in CalendarApp setta:

js
Copia
Modifica
setStatsView("monthly");
setIsStatsOpen(true);
in modo da renderizzare <StatsModal â€¦ />.

Come appare
Copertura full-screen semitrasparente (fixed inset-0 bg-black/30 backdrop-blur-sm overflow-auto p-2).

Contenitore centrale (max-width md) bianco, arrotondato, con ombra e margini verticali (rounded-lg shadow-xl w-full max-w-md mx-auto mt-8 mb-8).

Pulsante â€œXâ€ per chiudere in alto a destra.

Titolo â€œStatistiche Operatoriâ€.

Tre pulsanti di toggle (Mensile, Annuale, Operatore) per cambiare vista (statsView).

Calcolo delle statistiche (useMemo)
Allâ€™interno di StatsModal, appena montato, vengono calcolate varie mappe e classifiche:

statsByOperator

Itera su tutte le assegnazioni assignments (oggetto dal formato { "2025-04-05": { "Sala 1": "Maccioni", â€¦ }, â€¦ }).

Raggruppa per mese:

Per ogni data, ricava anno e mese ("2025-04"), inizializza un oggetto { [operatore]: 0, â€¦ } se non esiste, poi conta quante assegnazioni totali ha ricevuto ciascun operatore quel mese.

Risultato:

js
Copia
Modifica
{
  "2025-04": { Pestarino: 3, Maccioni: 5, â€¦ },
  "2025-05": { â€¦ },
  â€¦
}
rankingByMonth

Per ogni chiave di statsByOperator (es. "2025-04"), ordina gli operatori in base al conteggio discendente per trovare oro, argento, bronzo e li ordina in modo crescente per trovare â€œultimoâ€ (cucchiaino).

Restituisce un oggetto:

js
Copia
Modifica
{
  "2025-04": { gold: "Maccioni", silver: "Gemme", bronze: "Imelio", last: "Pestarino" },
  â€¦
}
statsAnnual

Sommando su base annua: scorre statsByOperator, per ogni "YYYY-MM" estrae "YYYY", e accumula i conteggi di ogni operatore.

Restituisce ad es. { "2025": { Maccioni: 20, Pestarino: 15, â€¦ }, â€¦ }.

rankingByYear

Come prima, ma per ogni anno in statsAnnual calcola oro/argento/bronzo/ultimo.

statsByOpCategory

Per ogni operatore, inizializza {Sala:0, Reparto:0, Olieria:0}.

Scorre tutte le assegnazioni: per ogni coppia (ruolo, operatore), incrementa il contatore corretto in base a role.toLowerCase().includes("sala"), "reparto" o altrimenti â€œOlieriaâ€.

Es. { Maccioni: { Sala: 12, Reparto: 5, Olieria: 3 }, â€¦ }.

rankingByOpCategories

Per ciascun operatore, ordina le tre categorie (Sala, Reparto, Olieria) in ordine decrescente di conteggio per stabilire oroCat/silverCat/bronzeCat e in ordine crescente per lastCat.

totalByOperator

Per ogni operatore calcola la somma totale di tutte e tre le categorie.

Restituisce un array di coppie [operatore, totale].

rankingGlobal

Ordina totalByOperator per trovare oro/silver/bronze e â€œultimoâ€ in base al totale globale.

Cosa mostra, a seconda di statsView
A) Vista Mensile (statsView === "monthly")
Tabella orizzontale:

Intestazione: prima colonna â€œOperatoreâ€, poi tante colonne quanti sono i mesi con almeno unâ€™assegnazione (ad es. "2025-04", "2025-05", â€¦).

Corpo: una riga per ogni operatore.

Nella cella corrispondente al mese, mostra il conteggio di sostituzioni per quellâ€™operatore quel mese e aggiunge:

ğŸ† accanto al numero se quellâ€™operatore Ã¨ il â€œgoldâ€ di quel mese (piÃ¹ sostituzioni).

ğŸ¥ˆ se â€œsilverâ€, ğŸ¥‰ se â€œbronzeâ€, ğŸ¥„ se â€œlastâ€ (meno sostituzioni).

Le celle ore sopra hanno uno sfondo colorato (giallo/argento/arancio/rosso) in base alla posizione.

Legenda Mensile sotto la tabella: spiega i colori e le icone.

B) Vista Annuale (statsView === "annual")
Per ogni anno (es. â€œ2025â€):

Stampa un blocco rettangolare con intestazione â€œ2025 â€“ Totaliâ€.

Allâ€™interno elenca tutti gli operatori ordinati per numero di sostituzioni annuali, dalla piÃ¹ alta alla piÃ¹ bassa.

Ogni riga mostra â€œOperatore â€“ conteggioâ€ e, se corrisponde a oro/argento/bronzo/ultimo di quellâ€™anno, aggiunge lâ€™icona e uno sfondo colorato.

Legenda Annuale sotto i blocchi: spiega significato di ğŸ†/ğŸ¥ˆ/ğŸ¥‰/ğŸ¥„.

C) Vista per Operatore (statsView === "byOperator")
Per ciascun operatore:

Mostra una â€œschedaâ€ (card) con:

Header:

Nome operatore e icona globale (ğŸ†/ğŸ¥ˆ/ğŸ¥‰/ğŸ¥„) in base al rango totale di sostituzioni.

Totale complessivo di sostituzioni (counts.Sala + counts.Reparto + counts.Olieria).

Sfondo colorato se oro/argento/bronzo/last a livello globale.

Griglia 3 colonne con le tre categorie (â€œSalaâ€, â€œRepartoâ€, â€œOlieriaâ€):

Per ognuna, mostra icona (ğŸ†/ğŸ¥ˆ/ğŸ¥‰/ğŸ¥„) se Ã¨ categoria primaria/secondaria/terziaria/last per quellâ€™operatore, e il conteggio nel mese complessivo.

Se nessuno ha fatto sostituzioni (tutti a zero), appare un messaggio â€œNessuna sostituzione registrataâ€.

Legenda per Operatore in basso: spiega icone e sfondi delle card e delle categorie.

Chiusura del modale
In alto a destra câ€™Ã¨ un tasto â€œâœ•â€: premendolo richiama close(), che chiama closeStats() in CalendarApp e imposta isStatsOpen = false, nascondendo lâ€™intero <StatsModal>.

4. Integrazione complessiva in CalendarApp
Variabili di stato relative ai modali
isM1Open â†’ quando true, viene renderizzato <ShiftModal â€¦ />.

isM2Open â†’ quando true, viene renderizzato <OperatorModal â€¦ />.

isStatsOpen â†’ quando true, viene renderizzato <StatsModal â€¦ />.

Apertura/Chiusura di un modale
ShiftModal (M1)

Apertura: clic su un giorno del calendario â†’ openM1(date) â†’ isM1Open = true.

Chiusura:

Premendo â€œXâ€ in ShiftModal â†’ closeM1() â†’ isM1Open = false.

Oppure premendo â€œSalvaâ€ â†’ salva assegnazioni â†’ isM1Open = false.

OperatorModal (M2)

Apertura:

Da dentro ShiftModal, clic matita di un ruolo â†’ openOperatorModal(role) â†’ isM2Open = true.

Chiusura:

Premendo â€œXâ€ in OperatorModal â†’ closeM2() â†’ isM2Open = false.

Oppure cliccando un operatore â†’ selectOperator(op) â†’ aggiorna tempAssignments e isM2Open = false.

StatsModal (M3)

Apertura:

Clic sul pulsante â€œStatisticheâ€ â†’ openStats() â†’ isStatsOpen = true, statsView = "monthly".

Chiusura:

Premendo â€œXâ€ in StatsModal â†’ closeStats() â†’ isStatsOpen = false.

Sequenza tipica di utilizzo
Lâ€™utente naviga nel calendario e clicca su una data: si apre ShiftModal (M1).

Allâ€™interno di M1, vede lâ€™elenco dei ruoli; per assegnarne uno, clicca la matita a destra di â€œSala 2â€, ad esempio.

Si apre OperatorModal (M2), con lâ€™elenco degli operatori non ancora usati; sceglie â€œMarmoratoâ€ e il modale si chiude, tornando in M1 con â€œSala 2 â†’ Marmoratoâ€ mostrato.

Lâ€™utente, finito di assegnare operatori a uno o piÃ¹ reparti, clicca â€œSalvaâ€ in ShiftModal: le assegnazioni vengono salvate in CalendarApp.assignments e M1 si chiude.

Ora il cubo del giorno nel calendario mostra delle pillole colorate (uno per ogni ruolo assegnato), e il contatore interno di assignments si Ã¨ aggiornato.

Se lâ€™utente vuole vedere le statistiche generali, clicca il pulsante â€œğŸ“Š Statisticheâ€ sotto al calendario: si apre StatsModal (M3).

In M3, puÃ² usare i tre pulsanti (Mensile, Annuale, Operatore) per avere viste diverse sui dati di assignments. Quando ha finito, preme â€œâœ•â€ e il modale si chiude.

Riepilogo â€œcosa fannoâ€ i modal, punto per punto
ShiftModal (M1)

Riceve la data selezionata (selectedDate) e le assegnazioni provvisorie di quel giorno (tempAssignments).

Mostra un elenco statico di ruoli (Sala 1, Sala 2, â€¦) e, se in tempAssignments[role] Ã¨ giÃ  definito, visualizza â€œruolo â†’ operatoreâ€.

Consente di:

Aprire il modale di selezione operatore (M2) per ciascun ruolo.

Salvare definitivamente le assegnazioni (aggiorna assignments in CalendarApp).

Chiudere senza salvare.

OperatorModal (M2)

Riceve la lista di tutti gli operatori (operators) e le assegnazioni provvisorie correnti (tempAssignments), piÃ¹ il selectedRole.

Disabilita (grigia) gli operatori giÃ  usati in tempAssignments.

Visualizza ogni operatore come pulsante; se Ã¨ quello giÃ  selezionato per selectedRole, appare evidenziato.

Quando lâ€™utente sceglie un operatore cliccandolo, aggiorna tempAssignments[selectedRole] = op e chiude il modale.

PuÃ² anche essere chiuso senza selezionare, semplicemente premendo â€œXâ€.

StatsModal (M3)

Riceve tutte le assegnazioni salvate (assignments) e la lista degli operatori.

Calcola, in memoria, varie statistiche (mensili, annuali, per categoria e globale).

Offre tre â€œtabâ€ (Mensile, Annuale, per Operatore):

Mensile: tabella con operatore vs mese, numeri di sostituzioni e icone/sfondi che indicano chi ha piÃ¹/meno sostituzioni in quel mese.

Annuale: blocchi per ogni anno, con elenco operatoreâ†’conteggio, icone per oro/argento/bronzo/last.

Per Operatore: card individuali che mostrano totale sostituzioni e ripartizione in Sala/Reparto/Olieria, con icone e sfondi che evidenziano la categoria di punta di ciascun operatore e chi Ã¨ primo/globale.

PuÃ² essere chiuso con â€œXâ€ in alto a destra.

Con questa spiegazione dettagliata, hai il quadro completo di come, quando e cosa succede allâ€™interno di ciascun modale dellâ€™applicazione: dalle chiamate a openâ€¦Modal(), alla gestione degli stati (isM1Open, isM2Open, isStatsOpen, tempAssignments e assignments), fino al rendering e alle interazioni (scelta degli operatori, salvataggio, visualizzazione delle statistiche).